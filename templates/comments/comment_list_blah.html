{% extends 'base.html' %}
{% block content %}
{% load staticfiles %}
<base href="/">
<script src={% static 'angular.min.js' %}></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.1/ui-bootstrap-tpls.min.js"></script>
<script  src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.25/angular-route.js"></script>
<script src={% static 'comments/app.js' %}></script>
<link href= {% static 'xeditable.css' %} rel="stylesheet"/>
<script src={% static 'xeditable.js' %}></script>

{% verbatim %}
<div ng-app="commentApp">
	<div class="container" ng-controller = "CommentViewController as ctr">
		<img class ="center-block" ng-src = "{{ctr.user.picture}}"/>
		<table ng-cloak style="table-layout: fixed" class = "table table-striped table-bordered">
			<thead>
				<tr>
				<th>Event and Date</th>
				<th>User</th>
				<th>Comment</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat = "item in ctr.all_comments | orderBy:'created_at'">
					<td><b>Date:</b> {{item.created_at | date:"MM/dd/yyyy"}}
					<br><b>Event:</b> {{item.event.name}}
					</td>
					<td>{{item.user.email}}</td>

					<td ng-if="ctr.isEqual(item) || ctr.is_admin == true" editable-textarea = "item.comment" onaftersave = "ctr.update(item)">{{item.comment}}</td>
					<td ng-if="ctr.isEqual(item) == false && ctr.is_admin ==  false ">{{item.comment}}</td>
				</tr>
			</tbody>
		</table>
		<form ng-submit="ctr.submit(ctr.comment)">

			<div class ="form-group row">
				<div class="col-md-6">
				<label ng-show = "ctr.is_admin" for = "selectUser">User:</label>
					<select ng-show = "ctr.is_admin" id="selectUser" style="margin-bottom:15px;" class="form-control"  ng-model = "ctr.comment.user" ng-options="user.id as user.email for user in ctr.users">
					</select>
				</div>
				<div class="col-md-6">
				<label for = "selectEvent">Event:</label>
					<select id="selectEvent" class="form-control"  ng-model = "ctr.comment.event" ng-options="event.id as event.title for event in ctr.events">
					</select>
				</div>
			</div>
			<div class="form-group row">
				<div class= "col-md-12 ">
				<label for = "commentText">Comment:</label>
					<textarea id="commentText" ng-model = "ctr.comment.comment" class="form-control"></textarea>
				</div>
			</div>
			<input type="submit" value="Submit" class="btn btn-primary"/>
		</form>
	</div>
</div>

{% endverbatim %}
<script>
var _currentUser = {
	'is_admin': {% filter lower %} {{perms.authentication.chapter_admin}} {% endfilter %},
	'user' : {{request.user.id}}
};
</script>
{% endblock %}